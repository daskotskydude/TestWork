# Cloudflare Pages Configuration

Use these settings when deploying to Cloudflare Pages:

## Build Configuration

```
Framework preset: Next.js
Build command: cd apps/web && npm install && npm run build
Build output directory: apps/web/.next
Root directory: (leave empty or set to root)
Node version: 18 or higher
```

## Environment Variables

Add these in the Cloudflare Pages dashboard under Settings > Environment Variables:

### Production + Preview

```
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
NEXT_PUBLIC_TURNSTILE_SITE_KEY=your_turnstile_site_key
TURNSTILE_SECRET_KEY=your_turnstile_secret_key
```

## Deployment Steps

1. **Connect GitHub Repository**
   - Go to Cloudflare Pages dashboard
   - Click "Create a project"
   - Select "Connect to Git"
   - Authorize GitHub and select your repository

2. **Configure Build Settings**
   - Use the build configuration above
   - Select production branch: `main`
   - Enable automatic deployments on push

3. **Add Environment Variables**
   - Navigate to Settings > Environment Variables
   - Add all 4 required variables
   - Apply to both Production and Preview environments

4. **Trigger First Deployment**
   - Push to main branch or click "Retry deployment"
   - Wait for build to complete (~3-5 minutes)
   - Visit the generated URL

## Custom Domain (Optional)

1. In Cloudflare Pages dashboard, go to Custom domains
2. Add your domain (must be on Cloudflare)
3. Configure DNS records automatically
4. Wait for SSL certificate (usually < 1 minute)

## Troubleshooting

### Build Fails
- Check Node version is 18+
- Verify build command includes `cd apps/web`
- Ensure all dependencies are in package.json

### Runtime Errors
- Verify all 4 environment variables are set
- Check Supabase URL format (https://xxx.supabase.co)
- Ensure anon key matches your project

### API Routes Not Working
- Confirm `runtime = 'nodejs'` export in API route files
- Check middleware.ts is not blocking API routes
- Verify rate limiting headers are being sent

## Performance Optimization

- Enable "Cloudflare for SaaS" for custom domains
- Use Cloudflare Images for logo/product images
- Enable "Speed" features in Cloudflare dashboard
- Monitor with Cloudflare Web Analytics (free)
